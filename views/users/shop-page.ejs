<%- include('../userlayout/header.ejs') %>


<!-- Header start  -->
<header class="ec-header">
    <!--Ec Header Top Start -->
    <div class="header-top">
        <div class="container">
            <div class="row align-items-center">
                <!-- Header Top responsive Action -->
                <div class="col d-lg-none ">
                    <div class="ec-header-bottons">
                        <!-- Header User Start -->
                        <div class="ec-header-user dropdown">
                            <button class="dropdown-toggle" data-bs-toggle="dropdown"><img
                                    src="assets/images/icons/user.svg" class="svg_img header_svg" alt="" /></button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <% if(session == null) { %>
                                    <li><a class="dropdown-item" href="/register">Register</a></li>
                                    <li><a class="dropdown-item" href="/login">Login</a></li>
                                    <% }else{ %>
                                    <li><a class="dropdown-item" href="/user-profile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                    <% } %>
                            </ul>
                        </div>
                        <!-- Header User End -->
                        <!-- Header Cart Start -->
                        <a href="/wishlist-page" class="ec-header-btn ec-header-wishlist">
                            <div class="header-icon"><img src="assets/images/icons/wishlist.svg"
                                    class="svg_img header_svg" alt="" /></div>
                        </a>
                        <!-- Header Cart End -->
                        <!-- Header Cart Start -->
                        <a href="/cart-page" class="ec-header-btn">
                            <div class="header-icon">
                                <img src="/assets/images/icons/cart.svg" class="svg_img header_svg" alt="" />
                            </div>
                        </a>
                        <!-- Header Cart End -->
                       
                        <a href="#ec-mobile-menu" class="ec-header-btn ec-side-toggle d-lg-none">
                            <img src="assets/images/icons/menu.svg" class="svg_img header_svg" alt="icon" />
                        </a>
                        <!-- Header menu End -->
                    </div>
                </div>
                <!-- Header Top responsive Action -->
            </div>
        </div>
    </div>
    <!-- Ec Header Top  End -->
    <!-- Ec Header Bottom  Start -->
    <div class="ec-header-bottom d-none d-lg-block">
        <div class="container position-relative">
            <div class="row">
                <div class="ec-flex">
                    <!-- Ec Header Logo Start -->
                    <div class="align-self-center">
                        <div class="header-logo">
                            <a href="/home-page"><h1>ESSENCE</h1></a>
                        </div>
                    </div>
                    <!-- Ec Header Logo End -->

                    <!-- Ec Header Search Start -->
                    <div class="align-self-center">
                        <div class="header-search">
                            <form class="ec-btn-group-form" method="post" action="/search-products">
                                <input class="form-control ec-search-bar" placeholder="Search products..." type="text" name="search">
                                <button class="submit" type="submit"><img src="assets/images/icons/search.svg"
                                        class="svg_img header_svg" alt="" /></button>
                            </form>
                        </div>
                    </div>
                    <!-- Ec Header Search End -->

                    <!-- Ec Header Button Start -->
                    <div class="align-self-center">
                        <div class="ec-header-bottons">

                            <!-- Header User Start -->
                            <div class="ec-header-user dropdown">
                                <button class="dropdown-toggle" data-bs-toggle="dropdown"><img
                                        src="assets/images/icons/user.svg" class="svg_img header_svg" alt="" /></button>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <% if(session == null) { %>
                                        <li><a class="dropdown-item" href="/register">Register</a></li>
                                        <li><a class="dropdown-item" href="/login">Login</a></li>
                                        <% }else{ %>
                                        <li><a class="dropdown-item" href="/user-profile">My Profile</a></li>
                                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                        <% } %>
                                </ul>
                            </div>
                            <!-- Header User End -->
                            <!-- Header wishlist Start -->
                            <a href="/wishlist-page" class="ec-header-btn ec-header-wishlist">
                                <div class="header-icon"><img src="assets/images/icons/wishlist.svg"
                                        class="svg_img header_svg" alt="" /></div>
                                <span class="ec-header-count">4</span>
                            </a>
                            <!-- Header wishlist End -->
                            <!-- Header Cart Start -->
                            <a href="/cart-page" class="ec-header-btn">
                                <div class="header-icon">
                                    <img src="/assets/images/icons/cart.svg" class="svg_img header_svg" alt="" />
                                </div>
                            </a>
                            <!-- Header Cart End -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Ec Header Button End -->
    <!-- Header responsive Bottom  Start -->
    <div class="ec-header-bottom d-lg-none">
        <div class="container position-relative">
            <div class="row ">

                <!-- Ec Header Logo Start -->
                <div class="col">
                    <div class="header-logo">
                        <a href="/home-page"><H3>ESSENCE</H3></a>
                    </div>
                </div>
                <!-- Ec Header Logo End -->
                <!-- Ec Header Search Start -->
                <div class="col">
                    <div class="header-search">
                        <form class="ec-btn-group-form" method="post" action="/search-products">
                            <input class="form-control ec-search-bar" placeholder="Search products..." name="search" type="text">
                            <button class="submit" type="submit"><img src="assets/images/icons/search.svg"
                                    class="svg_img header_svg" alt="icon" /></button>
                        </form>
                    </div>
                </div>
                <!-- Ec Header Search End -->
            </div>
        </div>
    </div>
    <!-- Header responsive Bottom  End -->
    <!-- EC Main Menu Start -->
    <div id="ec-main-menu-desk" class="d-none d-lg-block sticky-nav">
        <div class="container position-relative">
            <div class="row">
                <div class="col-md-12 align-self-center">
                    <div class="ec-main-menu">
                        <ul>
                            <li><a href="/home-page">Home</a></li>
                            <li><a href="/shop-page">Shop</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Ec Main Menu End -->
    <!-- ekka Mobile Menu Start -->
    <div id="ec-mobile-menu" class="ec-side-cart ec-mobile-menu">
        <div class="ec-menu-title">
            <span class="menu_title">My Menu</span>
            <button class="ec-close">Ã—</button>
        </div>
        <div class="ec-menu-inner">
            <div class="ec-menu-content">
                <ul>
                    <li><a href="/home-page">Home</a></li>
                    <li><a href="/shop-page">Shop</a></li>
                </ul>
            </div>
            <div class="header-res-lan-curr">
                <!-- Social Start -->
                <div class="header-res-social">
                    <div class="header-top-social">
                        <ul class="mb-0">
                            <li class="list-inline-item"><a class="hdr-facebook" href="#"><i class="ecicon eci-facebook"></i></a></li>
                            <li class="list-inline-item"><a class="hdr-twitter" href="#"><i class="ecicon eci-twitter"></i></a></li>
                            <li class="list-inline-item"><a class="hdr-instagram" href="#"><i class="ecicon eci-instagram"></i></a></li>
                            <li class="list-inline-item"><a class="hdr-linkedin" href="#"><i class="ecicon eci-linkedin"></i></a></li>
                        </ul>
                    </div>
                </div>
                <!-- Social End -->
            </div>
        </div>
    </div>
    <!-- ekka mobile Menu End -->
</header>
<!-- Header End  -->
<!-- Ec breadcrumb start -->
    <div class="sticky-header-next-sec  ec-breadcrumb section-space-mb">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="row ec_breadcrumb_inner">
                        <div class="col-md-6 col-sm-12">
                            <h2 class="ec-breadcrumb-title">Shop</h2>
                        </div>
                        <div class="col-md-6 col-sm-12">
                            <!-- ec-breadcrumb-list start -->
                            <ul class="ec-breadcrumb-list">
                                <li class="ec-breadcrumb-item"><a href="index.html">Home</a></li>
                                <li class="ec-breadcrumb-item active">Shop</li>
                            </ul>
                            <!-- ec-breadcrumb-list end -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Ec breadcrumb end -->

    <div id="relodDiv">
        <!-- Ec Shop page -->
        <section class="ec-page-content-bnr section-space-pb bg-light">
            <div class="container">
                <div class="row">
                    <div class="ec-shop-rightside col-lg-9 order-lg-last col-md-12 order-md-first margin-b-30">
                        <!-- Shop Top Start -->
                        <div class="ec-pro-list-top d-flex">
                            <div class="col-md-6 ec-grid-list">

                            </div>
                            <!-- <div class="col-md-6 ec-sort-select">
                                <span class="sort-by">Sort by</span>
                                <div class="ec-select-inner">
                                    <select name="ec-select" id="ec-select">
                                        <option value="/price-sort/1">Price, low to high</option>
                                        <option value="/price-sort/-1">Price, high to low</option>
                                    </select>
                                </div>
                            </div> -->
                        </div>
                        <!-- Shop Top End -->

                        <!-- Shop content Start -->





                        <div class="shop-pro-content">
                            <div class="shop-pro-inner">
                                <div class="row">

                                    <% if(product.length> 0){
                                        for(let i=0;i<product.length;i++){ %>


                                            <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 mb-6 pro-gl-content">
                                                <div class="ec-product-inner">
                                                    <div class="ec-pro-image-outer">
                                                        <div class="ec-pro-image">
                                                            <a href="/showProduct?id=<%= product[i]._id %>" class="">
                                                                <img class="main-image"
                                                                    src="/adminAssets/adminImages/<%= product[i].image[0]  %>"
                                                                    alt="Product image" width="250px" height="300px" />

                                                            </a>
                                                            <% if ( product[i].discountPercentage <= 0) {
                                                                
                                                            }else{  %>
                                                            <span class="percentage"><%= product[i].discountPercentage %>%</span>
                                                             <% } %>

                                                            <div class="ec-pro-actions">
                                                                <button title="Add To Cart"
                                                                    onclick="addtocart('<%=product[i]._id%>')"
                                                                    class=" add-to-cart"><img
                                                                        src="assets/images/icons/cart.svg"
                                                                        class="svg_img pro_svg" alt="" /> Add To Cart</button>
                                                                <a class="ec-btn-group wishlist" onclick="addWishlist('<%=product[i]._id%>')" title="Wishlist"><img
                                                                        src="assets/images/icons/wishlist.svg"
                                                                        class="svg_img pro_svg" alt="" /></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="ec-pro-content">
                                                        <p>
                                                            <%= product.brand %>
                                                        </p>
                                                        <h5 class="ec-pro-title"><a
                                                                href="/showProduct?id=<%= product[i]._id %>">
                                                                <%= product[i].productname %>
                                                            </a></h5>

                                                        <div class="ec-pro-list-desc"></div>
                                                        <span class="ec-price">
                                                            <% 
                                                              const discount =  product[i].discountPercentage 

                                                               const price =  product[i].price 

                                                               const disAmount = Math.round((price*discount)/100)

                                                               const total = price - disAmount


                                                            %>
                                                            <% if(disAmount <= 0) {%>
                                                            <span class="new-price">â‚¹ <%= product[i].price %>.00</span>
                                                            <% }else{ %>
                                                                <del class="new-price text-danger">â‚¹ <%= product[i].price %>.00</del> 
                                                                <span class="new-price">â‚¹ <%= total %>.00</span>

                                                                <% } %>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                            <% } } %>

                                </div>
                            </div>




                            <!-- Ec Pagination Start -->
                            <div class="ec-pro-pagination">
                                <span>Showing 1- <%= totalPages %> of <%= product.length %> item(s)</span>
                                <ul class="ec-pro-pagination-inner">
                                    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                        <a class="prev" href="?page=<%= currentPage - 1 %>" aria-label="Previous" tabindex="-1" aria-disabled="true">
                                            <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                                        </a>
                                    </li>
                                    <% for (let i = 1; i <= totalPages; i++) { %>
                                <li class="page-item <%= currentPage === i ? 'active' : '' %> ms-2" aria-current="page">
                                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                </li>
                                   <% } %>
                                   <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                <a class="next" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                                    Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                                </a>
                               </li>

                                </ul>
                            </div>
                            <!-- Ec Pagination End -->
                        </div>
                        <!--Shop content End -->



                    </div>
                    <!-- Sidebar Area Start -->
                    <div class="ec-shop-leftside col-lg-3 order-lg-first col-md-12 order-md-last">
                        <div id="shop_sidebar">
                            <div class="ec-sidebar-heading">
                                <h1>Filter Products By</h1>
                            </div>
                            <div class="ec-sidebar-wrap">
                                <!-- Sidebar Category Block -->
                                <div class="ec-sidebar-block">
                                    <div class="ec-sb-title">
                                        <h3 class="ec-sidebar-title">Category</h3>
                                    </div>
                                    <div class="ec-sb-block-content">
                                        <ul>
                                            <% if(category.length>0){
                                                for(let i=0;i<category.length;i++){ %>

                                                    <li>
                                                        <div class="ec-sidebar-block-item">
                                                           

                                                              <a href="/filter-category/<%= category[i].categoryname %>">
                                                                <%= category[i].categoryname %>
                                                            </a>
                                                        </div>
                                                    </li>

                                                    <% } } %>
                                                    <li>
                                                        <div class="ec-sidebar-block-item">
                                                           

                                                              <a href="/shop-page">
                                                                All
                                                            </a>
                                                        </div>
                                                    </li>

                                        </ul>
                                    </div>
                                </div>
                                <!-- Sidebar Size Block -->
                                <div class="ec-sidebar-block">
                                    <div class="ec-sb-title">
                                        <h3 class="ec-sidebar-title">Price Filter</h3>
                                    </div>
                                    <div class="ec-sb-block-content">
                                        <ul>
                                                    <li>
                                                        <div class="ec-sidebar-block-item">
                                                           <a href="/price-sort/<%= 1 %>"> Low To High </a> 
                                                        </div>
                                                     </li>
                                                     <li>   
                                                        <div class="ec-sidebar-block-item">
                                                            <a href="/price-sort/<%= -1%>"> High To Low </a> 
                                                        </div>
                                                    </li>

                                        </ul>
                                    </div>
                                </div>
                                <!-- Sidebar Size Block -->
                        

                                <!-- Sidebar Price Block -->
                                <div class="ec-sidebar-block">
                                    <div class="ec-sb-title">
                                        <h3 class="ec-sidebar-title">Price</h3>
                                    </div>
                                    <div class="ec-sb-block-content es-price-slider">
                                        <div class="ec-price-filter">
                                            <div id="ec-sliderPrice" class="filter__slider-price" data-min="0"
                                                data-max="250" data-step="10"></div>
                                            <div class="ec-price-input">
                                                <label class="filter__label"><input type="text"
                                                        class="filter__input"></label>
                                                <span class="ec-price-divider"></span>
                                                <label class="filter__label"><input type="text"
                                                        class="filter__input"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
        <script>

            function addtocart(productid) {
                $.ajax({
                    url: "/addtocart",
                    method: "post",
                    data: {
                        id: productid
                    },
                    success: (response) => {
                        if (response.success) {
                            swal.fire({
                                positon: 'center',
                                icon: "success",
                                title: 'product added to cart',
                                showConfirmButton: false,
                                timer: 1500,
                            })
                        }else {
                        swal.fire({ 
                        icon: 'error',
                        title: 'Oops...',
                        text: response.message
                        });
                    } 
                    }
                })
            }
            
          

            
            function addWishlist(id){
               $.ajax({
              
                url:'/addtoWishlist',
                method:'post',
                data: {
                        proId:id
                    },
                    success: (response) => {
                        swal.fire({
                                positon: 'center',
                                icon: "success",
                                title: 'product added to wishlist',
                                showConfirmButton: false,
                                timer: 1500,
                            })
                        }

               })
            }

             

        </script>

        <%- include('../userlayout/footer.ejs') %>